---
import BaseLayout from "./BaseLayout.astro";
const { frontmatter } = Astro.props;

// Format salary for display
const formatSalary = (salary) => {
  const formatted = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: salary.currency,
    minimumFractionDigits: 0
  }).format(salary.value);
  return `${formatted}/${salary.unitText.toLowerCase()}`;
};

// Format the JSON-LD data
const jobSchema = {
  "@context": "https://schema.org/",
  "@type": "JobPosting",
  "title": frontmatter.position,
  "description": frontmatter.description,
  "identifier": {
    "@type": "PropertyValue",
    "name": frontmatter.companyDetails.name,
    "value": frontmatter.identifier.value
  },
  "datePosted": frontmatter.datePosted,
  "validThrough": frontmatter.validThrough,
  "employmentType": frontmatter.employmentType,
  "experienceRequirements": frontmatter.experienceRequirements,
  "occupationalCategory": frontmatter.occupationalCategory,
  "hiringOrganization": {
    "@type": "Organization",
    "name": frontmatter.companyDetails.name,
    "sameAs": frontmatter.companyDetails.url,
    "logo": frontmatter.companyDetails.logo
  },
  "jobLocation": {
    "@type": "Place",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": frontmatter.address.street,
      "addressLocality": frontmatter.address.city,
      "addressRegion": frontmatter.address.region,
      "postalCode": frontmatter.address.postalCode,
      "addressCountry": frontmatter.address.country
    }
  },
  "baseSalary": {
    "@type": "MonetaryAmount",
    "currency": frontmatter.salary.currency,
    "value": {
      "@type": "QuantitativeValue",
      "value": frontmatter.salary.value,
      "unitText": frontmatter.salary.unitText
    }
  }
};
---

<BaseLayout>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(jobSchema, null, 2)} />
  </Fragment>
  <section>
    <div class="mx-auto max-w-7xl lg:px-16 md:px-12 px-8 xl:px-24 lg:flex py-24">
      <div class="lg:w-1/2 lg:pl-12 lg:ml-auto">
        <div class="lg:sticker lg:sticky pb-16 pt-8 top-0">
          <div class="lg:pl-36 md:pl-12">
            <nav aria-label="Sidebar" class="bg-slate-50 rounded-lg divide-y space-y-3 p-4 lg:p-8">
              <div>
                <h3 class="text-lg text-purple-900">Job Details</h3>
                <div class="space-y-3 mt-4">
                  <div>
                    <p class="text-sm font-medium text-slate-500">Location</p>
                    <p class="text-sm text-slate-700">{frontmatter.location}</p>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-slate-500">Team</p>
                    <p class="text-sm text-slate-700">{frontmatter.team}</p>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-slate-500">Employment Type</p>
                    <p class="text-sm text-slate-700">{frontmatter.employmentType}</p>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-slate-500">Salary</p>
                    <p class="text-sm text-slate-700">{formatSalary(frontmatter.salary)}</p>
                  </div>
                </div>
              </div>
              <div class="pt-4 flex">
                <a
                  class="text-white items-center font-medium gap-3 inline-flex focus-visible:outline-2 focus-visible:outline-offset-2 focus:outline-none justify-center px-6 lg:px-8 ring-2 ring-transparent focus:ring-offset-2 focus:ring-blue-500 duration-200 py-3.5 rounded-full active:bg-blue-800 active:text-white bg-blue-500 hover:bg-blue-600 w-full"
                  href="/jobs/job-application">
                  Apply now
                </a>
              </div>
            </nav>
          </div>
        </div>
      </div>
      <div class="lg:w-1/2 lg:order-first">
        <div class="flex-shrink-0">
          <p class="text-purple-900 font-semibold mt-6 text-3xl tracking-tight lg:text-balance">
            {frontmatter.position}
          </p>
          <div class="prose prose-slate mt-6 max-w-none">
            <slot />
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="bg-white">
    <div class="lg:p-8">
      <div class="bg-purple-900 max-w-7xl mx-auto lg:rounded-3xl">
        <div class="mx-auto max-w-7xl lg:px-16 md:px-12 px-8 xl:px-24 py-24">
          <div>
            <h2 class="text-white font-semibold tracking-tighter lg:text-5xl text-3xl">
              We look forward to hearing from you
            </h2>
            <p class="text-slate-300 mt-5 lg:text-balance">
              At Tustin Recruiting, we're looking for people with passion, grit, and integrity. 
              You're encouraged to apply even if your experience doesn't precisely match the job description. 
              Your skills and passion will stand out—and set you apart—especially if your career has taken 
              some extraordinary twists and turns. We welcome diverse perspectives and people who think 
              rigorously and aren't afraid to challenge assumptions. Join us.
            </p>
            <div class="mt-10 flex">
              <a
                class="text-white items-center font-medium gap-3 inline-flex focus-visible:outline-2 focus-visible:outline-offset-2 focus:outline-none justify-center px-6 lg:px-8 ring-2 ring-transparent focus:ring-offset-2 focus:ring-blue-500 duration-200 py-3.5 rounded-full active:bg-blue-800 active:text-white bg-blue-500 hover:bg-blue-600 w-auto"
                href="/jobs/job-application">
                Apply now
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
